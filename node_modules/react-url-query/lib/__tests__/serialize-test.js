'use strict';

var _serialize = require('../serialize');

describe('utils', function () {
  describe('serialization', function () {
    describe('encodeDate', function () {
      it('produces the correct value', function () {
        var date = new Date(2016, 2, 1);
        var result = (0, _serialize.encodeDate)(date);
        expect(result).toBe('2016-03-01');
      });

      it('handles null and undefined', function () {
        var result = (0, _serialize.encodeDate)(null);
        expect(result).toBeNull();
        expect((0, _serialize.encodeDate)()).not.toBeDefined();
      });
    });

    describe('decodeDate', function () {
      it('produces the correct value', function () {
        var result = (0, _serialize.decodeDate)('2016-03-01');
        // result is a Date object
        expect(result.getFullYear()).toBe(2016);
        expect(result.getMonth()).toBe(2);
        expect(result.getDate()).toBe(1);

        // javascript likes to give us 2015-12-31 19:00, so test this doesn't.
        result = (0, _serialize.decodeDate)('2016');
        expect(result.getFullYear()).toBe(2016);
        expect(result.getMonth()).toBe(0);
        expect(result.getDate()).toBe(1);
      });

      it('handles null and undefined', function () {
        var result = (0, _serialize.decodeDate)(null);
        expect(result).not.toBeDefined();
        expect((0, _serialize.decodeDate)()).not.toBeDefined();
        expect((0, _serialize.decodeDate)('')).not.toBeDefined();
      });

      it('handles malformed input', function () {
        var result = (0, _serialize.decodeDate)('foo-one-two');
        expect(result).not.toBeDefined();
      });
    });

    describe('encodeBoolean', function () {
      it('produces the correct value', function () {
        expect((0, _serialize.encodeBoolean)(true)).toBe('1');
        expect((0, _serialize.encodeBoolean)(false)).toBe('0');
        expect((0, _serialize.encodeBoolean)()).not.toBeDefined();
      });
    });

    describe('decodeBoolean', function () {
      it('produces the correct value', function () {
        expect((0, _serialize.decodeBoolean)('1')).toBe(true);
        expect((0, _serialize.decodeBoolean)('0')).toBe(false);
        expect((0, _serialize.decodeBoolean)()).not.toBeDefined();
        expect((0, _serialize.decodeBoolean)('')).not.toBeDefined();
      });

      it('handles malformed input', function () {
        expect((0, _serialize.decodeBoolean)('foo')).not.toBeDefined();
      });
    });

    describe('encodeJson', function () {
      it('produces the correct value', function () {
        var input = { test: '123', foo: [1, 2, 3] };
        expect((0, _serialize.encodeJson)(input)).toBe(JSON.stringify(input));
        expect((0, _serialize.encodeJson)()).not.toBeDefined();
        expect((0, _serialize.encodeJson)(null)).not.toBeDefined();
        expect((0, _serialize.encodeJson)(0)).toBe('0');
        expect((0, _serialize.encodeJson)(false)).toBe('false');
      });
    });

    describe('decodeJson', function () {
      it('produces the correct value', function () {
        var output = (0, _serialize.decodeJson)('{"foo": "bar", "jim": ["grill"]}');
        var expectedOutput = {
          foo: 'bar',
          jim: ['grill']
        };
        expect(output).toEqual(expectedOutput);
        expect((0, _serialize.decodeJson)()).not.toBeDefined();
        expect((0, _serialize.decodeJson)('')).not.toBeDefined();
      });

      it('handles malformed input', function () {
        expect((0, _serialize.decodeJson)('foo')).not.toBeDefined();
      });
    });

    describe('encodeArray', function () {
      it('produces the correct value', function () {
        var input = ['a', 'b', 'c'];
        expect((0, _serialize.encodeArray)(input)).toBe('a_b_c');
        expect((0, _serialize.encodeArray)()).not.toBeDefined();
      });
    });

    describe('decodeArray', function () {
      it('produces the correct value', function () {
        var output = (0, _serialize.decodeArray)('a_b_c');
        var expectedOutput = ['a', 'b', 'c'];

        expect(output).toEqual(expectedOutput);
        expect((0, _serialize.decodeArray)()).not.toBeDefined();
        expect((0, _serialize.decodeArray)('')).not.toBeDefined();
      });

      it('handles empty values', function () {
        expect((0, _serialize.decodeArray)('__')).toEqual([undefined, undefined, undefined]);
      });
    });

    describe('encodeObject', function () {
      it('produces the correct value', function () {
        var input = { test: 'bar', foo: 94 };
        var expectedOutput = 'test-bar_foo-94';
        expect((0, _serialize.encodeObject)(input, '-', '_')).toBe(expectedOutput);
        expect((0, _serialize.encodeObject)()).not.toBeDefined();
        expect((0, _serialize.encodeObject)({})).not.toBeDefined();
      });
    });

    describe('decodeObject', function () {
      it('produces the correct value', function () {
        var output = (0, _serialize.decodeObject)('foo-bar_jim-grill_iros-91');
        var expectedOutput = {
          foo: 'bar',
          jim: 'grill',
          iros: '91'
        };
        expect(output).toEqual(expectedOutput);
        expect((0, _serialize.decodeObject)()).not.toBeDefined();
        expect((0, _serialize.decodeObject)('')).not.toBeDefined();
      });

      it('handles malformed input', function () {
        expect((0, _serialize.decodeJson)('foo-bar-jim-grill')).not.toBeDefined();
        expect((0, _serialize.decodeJson)('foo_bar_jim_grill')).not.toBeDefined();
      });
    });

    describe('decode', function () {
      it('decodes by type', function () {
        var input = '91';
        expect((0, _serialize.decode)('number', input)).toBe(91);
      });

      it('decodes using default value', function () {
        var input = undefined;
        expect((0, _serialize.decode)('number', input, '94')).toBe('94');
      });

      it('decodes using custom function', function () {
        var input = '94';
        expect((0, _serialize.decode)(function (d) {
          return parseInt(d + d, 10);
        }, input)).toBe(9494);
      });

      it('decodes using object with .decode custom function', function () {
        var input = '94';
        expect((0, _serialize.decode)({ decode: function decode(d) {
            return parseInt(d + d, 10);
          } }, input)).toBe(9494);
      });

      it('handles no decoder found', function () {
        var input = '94';
        expect((0, _serialize.decode)('fancy', input)).toBe(input);
      });
    });

    describe('encode', function () {
      it('encodes by type', function () {
        var input = 91;
        expect((0, _serialize.encode)('number', input)).toBe('91');
      });

      it('encodes using custom function', function () {
        var input = 94;
        expect((0, _serialize.encode)(function (d) {
          return '' + d + d;
        }, input)).toBe('9494');
      });

      it('encodes using object with .encode custom function', function () {
        var input = 94;
        expect((0, _serialize.encode)({ encode: function encode(d) {
            return '' + d + d;
          } }, input)).toBe('9494');
      });

      it('handles no encoder found', function () {
        var input = 94;
        expect((0, _serialize.encode)('fancy', input)).toBe(input);
      });
    });

    describe('decode+encode', function () {
      it('encode(decode(number)) === number', function () {
        var input = '91';
        expect((0, _serialize.encode)('number', (0, _serialize.decode)('number', input))).toBe(input);
      });

      it('decode(encode(number)) === number', function () {
        var input = 91;
        expect((0, _serialize.decode)('number', (0, _serialize.encode)('number', input))).toBe(input);
      });

      it('encode(decode(boolean)) === boolean', function () {
        var input = '0';
        expect((0, _serialize.encode)('boolean', (0, _serialize.decode)('boolean', input))).toBe(input);
      });

      it('decode(encode(boolean)) === boolean', function () {
        var input = true;
        expect((0, _serialize.decode)('boolean', (0, _serialize.encode)('boolean', input))).toBe(input);
      });

      it('encode(decode(date)) === date', function () {
        var input = '2016-03-01';
        expect((0, _serialize.encode)('date', (0, _serialize.decode)('date', input))).toBe(input);
      });

      it('decode(encode(date)) === date', function () {
        var input = new Date(2016, 2, 1);
        expect((0, _serialize.decode)('date', (0, _serialize.encode)('date', input))).toEqual(input);
      });

      it('encode(decode(json)) === json', function () {
        var input = '{"foo":"bar","baz":["jim"]}';
        expect((0, _serialize.encode)('json', (0, _serialize.decode)('json', input))).toBe(input);
      });

      it('decode(encode(json)) === json', function () {
        var input = { foo: 'bar', baz: ['jim'] };
        expect((0, _serialize.decode)('json', (0, _serialize.encode)('json', input))).toEqual(input);
      });

      it('encode(decode(object)) === object', function () {
        var input = 'foo-bar_baz-jim';
        expect((0, _serialize.encode)('object', (0, _serialize.decode)('object', input))).toBe(input);
      });

      it('decode(encode(object)) === object', function () {
        var input = { foo: 'bar', baz: 'jim' };
        expect((0, _serialize.decode)('object', (0, _serialize.encode)('object', input))).toEqual(input);
      });

      it('encode(decode(array)) === array', function () {
        var input = 'A_R_R_A_Y';
        expect((0, _serialize.encode)('array', (0, _serialize.decode)('array', input))).toBe(input);
      });

      it('decode(encode(array)) === array', function () {
        var input = ['A', 'R', 'R', 'A', 'Y'];
        expect((0, _serialize.decode)('array', (0, _serialize.encode)('array', input))).toEqual(input);
      });
    });
  });
});